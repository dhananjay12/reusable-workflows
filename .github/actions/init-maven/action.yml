name: "Initialize Java Maven"
description: "Checkout and setup Java and maven cache(based on pom.xml)"
inputs:
  java-version:
    description: "Java version to Initialize repo"
    required: false
    default: "17"
  distribution:
    description: "Whether to cache dependencies or not."
    required: false
    default: "adopt"
  id:
    description: 'Repo ID'
    required: false
    default: 'my-maven-repo'
  url:
    description: 'URL of Maven Repo to Deploy'
    required: true
runs:
  using: "composite"
  steps:
    - name: Checkout
      uses: actions/checkout@v3
    - name: Setup JDK ${{ inputs.java-version }}
      uses: actions/setup-java@v3
      with:
        java-version: ${{ inputs.java-version }}
        distribution: ${{ inputs.distribution }}
        server-id: github
        settings-path: ${{ github.workspace }}
    - name: Configure Maven To Deploy
      uses: whelk-io/maven-settings-xml-action@v21
      with:
        repositories: '[{ "id": "${{ inputs.id }}", "url": "${{ inputs.url }}" }]'
        plugin_repositories: '[{ "id": "${{ inputs.id }}-plugins", "url": "${{ inputs.url }}" }]'
        servers: '[{ "id": "${{ inputs.id }}", "username": "${{ inputs.username }}", "password": "${{ inputs.password }}" },{ "id": "${{ inputs.id }}-plugins", "username": "${{ inputs.username }}", "password": "${{ inputs.password }}" }]'
    - name: Cache local Maven repository
      uses: actions/cache@v3
      id: cache
      with:
        path: ~/.m2/repository
        key: ${{ runner.os }}-maven-${{ hashFiles('**/pom.xml') }}
        restore-keys: |
          ${{ runner.os }}-maven-
    - name: Install dependencies
      id: install
      if: steps.cache.outputs.cache-hit != 'true'
      run: |
        mvn compile
      shell: bash